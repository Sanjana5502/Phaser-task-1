<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Phaser Game</title>
    <style>
      body {
        height: 100vh;
        margin: 0;
        font-family: Arial, sans-serif;
      }

      #counter-display {
        margin-top: 1px;
        font-size: 18px;
        color: black;
      }

      #right-panel {
        background-color: #f0f0f0;
        padding: 15px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      .session-card {
        border: 1px solid #ccc;
        padding: 10px;
        margin: 10px 0;
        cursor: pointer;
        transition: background-color 0.3s;
        border-radius: 5px;
      }

      .session-card:hover {
        background-color: #f5f5f5;
      }

      .session-details {
        border: 1px solid #ccc;
        padding: 10px;
        margin-top: 10px;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <div id="game-container"></div>
    <div id="right-panel">
      <h2>Session History</h2>
      <button onclick="startSession()">Start Session</button>
      <div id="display"></div>
      <div id="counter-display"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/phaser/dist/phaser.min.js"></script>
    <script>
      const config = {
        type: Phaser.AUTO,
        width: 950,
        height: 500,
        physics: {
          default: "arcade",
          arcade: {
            gravity:{y:400},
            debug: false,
          },
        },
        scene: {
          preload: preload,
          create: create,
          update: update,
        },
      };

      const game = new Phaser.Game(config);
      let clockSound;
      let ball;
      let isSessionActive = false;
      function preload() {
        this.load.image("ball", "./ball.png");
        this.load.audio("clock", "./clock-sound.mp3");
      //  this.load.image('sky', './clouds.png');
      }
      function create() {
        ball = this.physics.add.sprite(100, 800, "ball");
        ball.setBounce(0);
        ball.setCollideWorldBounds(true);
        ball.setVelocity(0, 0);
        ball.setScale(0.1);
        clockSound = this.sound.add("clock");
        //this.add.image(400, 300, 'sky');
      }
      function update() {
        if (isSessionActive) {
        }
      }

      function moveBall() {
        if (isSessionActive) {
          ball.setVelocity(0, 600);
        }
      }
      const sessionList = [];
      function startSession() {
        if (isSessionActive) {
          console.log("Session is active");
          return;
        }
        isSessionActive = true;
        ball.setBounce(1)
        const sessionId = generateSessionId();
        const counter = Phaser.Math.Between(30, 60);
        const startTime = new Date();
        const endTime = new Date(startTime.getTime() + counter * 1000);
        startCountdownAndMove(counter, sessionId, startTime, endTime);
      }
      function startCountdownAndMove(counter, sessionId, startTime, endTime) {
        let currentCounter = counter;
        const countdownInterval = setInterval(() => {
          document.getElementById(
            "counter-display"
          ).textContent = `Counter: ${currentCounter}s`;
          clockSound.play();

          if (currentCounter === 0) {
            clearInterval(countdownInterval);
            document.getElementById("counter-display").textContent =
              "Session Ended";
            isSessionActive = false;
            ball.setBounce(0)
            clockSound.stop();
            sessionList.push({ sessionId, startTime, endTime });
            updateSessionList();
          }
          currentCounter--;
        }, 1000);
        moveBall();
      }
      function generateSessionId() {
      return Date.now().toString(36) + Math.random().toString(36).substring(7);
      }
      function updateSessionList() {
        const sessionListElement = document.getElementById("display");
        sessionListElement.innerHTML = "";

        sessionList.forEach((session) => {
          const listItem = document.createElement("div");
          listItem.classList.add("session-card");
          listItem.textContent = `Session ID: ${session.sessionId}`;
          listItem.addEventListener("click", () => toggleSessionDetails(session, listItem));
          sessionListElement.appendChild(listItem);
        });
      }
      function toggleSessionDetails(session, listItem) {
        const detailsContainer = document.getElementById("display");
        const existingDetails = listItem.querySelector('.session-details');

        if (existingDetails) {
          existingDetails.remove();
        } else {
          const card = document.createElement("div");
          card.classList.add("session-details", "session-card");

          const startTimeElement = document.createElement("p");
          startTimeElement.textContent = `Start Time: ${session.startTime}`;

          const endTimeElement = document.createElement("p");
          endTimeElement.textContent = `End Time: ${session.endTime}`;

          card.appendChild(startTimeElement);
          card.appendChild(endTimeElement);

          listItem.appendChild(card);
        }
      }
    </script>
  </body>
</html>
